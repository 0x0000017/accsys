{% extends 'Main/Landing/mainLayout.html' %}
{% load static %}
{% block content %}

    <div class = "row">
    <div class="container d-flex justify-content-center  mb-4">

        <div class="search">
            <label>
                <form method="post">
                    {% csrf_token %}
                    <input name="searched_items" type="text" placeholder="Search Inventory">
                    <ion-icon type="submit" value="Search" name="search-outline"></ion-icon>
                </form>
            </label>
        </div>
    </div>

    <div class ="col-12">
        <div class ="inventoryCardBox">
            <h2>Item Lists</h2>

            <!-- <div class="col-md-12 bg-light">
                <button type="button" class="btn btn-success btn-sm m-2 px-2 py-2">Date</button>
                <button type="button" class="btn btn-success btn-sm m-2 px-2 py-2">Name</button>
                <button type="button" class="btn btn-success btn-sm m-2 px-2 py-2">Price</button>
                <button type="button" class="btn btn-success btn-sm m-2 px-2 py-2">Category</button>
                <button type="button" class="btn btn-success btn-sm m-2 px-2 py-2">Quantity</button>
            </div> -->
            
            <div class="dropdown">
                <button class="btn btn-primary dropdown-toggle my-2" type="button" data-bs-toggle="dropdown" aria-expanded="false" style="font-family: Metropolis;">
                    Sort by:
                </button>

                <ul class="dropdown-menu" style="font-family: Metropolis;">
                    <li><a class="dropdown-item" href="{% url 'inventory' 'item_name' %}">Name</a></li>
                    <li><a class="dropdown-item" href="{% url 'inventory' 'item_price' %}">Price</a></li>
                    <li><a class="dropdown-item" href="{% url 'inventory' 'category' %}">Category</a></li>
                    <li><a class="dropdown-item" href="{% url 'inventory' 'date_ordered' %}">Date</a></li>
                    <li><a class="dropdown-item" href="{% url 'inventory' 'quantity' %}">Quantity</a></li>
                </ul>
            </div>

            <table class="table table-striped table-hover">
                <thead class="thead-dark">
                <tr>
                    <th class="text-center" scope="col">ITEM NAME</th>
                    <th class="text-center" scope="col">ITEM PRICE</th>
                    <th class="text-center" scope="col">PURCHASE COST</th>
                    <th class="text-center" scope="col">CATEGORY</th>
                    <th class="text-center" scope="col">DATE ORDERED</th>
                    <th class="text-center" scope="col">QUANTITY</th>
                    <th class="text-center" scope="col">ACTIONS</th>
                    <th class="text-center" scope="col">SOLD</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                {% for item in items %}
                    {% if not item.is_deleted %}
                        <tr class="text-center" >
                        <td>{{ item.item_name }}</td>
                        <td>₱ {{ item.item_price }}</td>
                        <td>₱ {{ item.expense }}</td>
                        <td>{{ item.category }}</td>
                        <td>{{ item.date_ordered.date }}</td>
                        {% if item.quantity == 0 %}
                            <td>Sold Out</td>
                        {% else %}
                            <td>{{ item.quantity }}</td>
                        {% endif %}
                            <td>
                                <button type="button"
                                        class="btn btn-primary"
                                        data-bs-toggle="modal"
                                        data-bs-target="#editItemsModal-{{ item.id }}"
                                >
                                    <ion-icon name="create-outline" style="font-size: 1.13em;"></ion-icon>
                                </button>
                                <button type="button"
                                        class="btn btn-danger"
                                        data-bs-toggle="modal"
                                        data-bs-target="#deleteItemModal-{{ item.id }}">
                                    <ion-icon name="trash-outline" style="font-size: 1.13em;"></ion-icon>
                                </button>
                            </td>
                            <td>
                                <button type="button"
                                        data-bs-toggle="modal"
                                        data-bs-target="#soldItemsModal-{{ item.id }}"
                                        class="btn btn-success">
                                    <ion-icon name="remove-circle-outline" style="font-size: 1.13em;"></ion-icon>
                                </button>
                            </td>
                            </tr>

                            <!-- MODALS -->
                            <div class="modal fade" id="editItemsModal-{{ item.id }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <form action="/update_item/{{ item.id }}" method="post">
                                {% csrf_token %}
                                <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="exampleModalLabel"> Edit </h1>
                                    <button type="button" class="btn-close"
                                    data-bs-dismiss="modal" aria-label="Close"
                                    (click)="closeClick()"></button>
                                </div>

                                <div class="modal-body">
                                    <div class ="form-group">
                                        <div class="row"> </div>
                                        <div class="mb-1">
                                            <label for="itemName" class="form-label">Item name:</label>
                                            <input type="text" class="form-control input-sm" id="itemName" name="item_name" value ="{{ item.item_name }}" required>
                                        </div>

                                        <div class="mb-1">
                                            <label for="itemPrice" class="form-label">Item Price:</label>
                                            <input type="text" class="form-control input-sm" id="itemPrice" name="item_price" value="{{ item.item_price }}" required>
                                        </div>

                                        <div class="mb-1">
                                            <label for="category" class="form-label">Category:</label>
                                            <input type="text" class="form-control input-sm" id="category" name="category" value="{{ item.category }}" required>
                                        </div>

                                        <div class="mb-1">
                                            <label for="dateOrdered" class="form-label">Date Ordered:</label>
                                            <input type="date" class="form-control" id="dateOrdered" name="date_ordered" value="{{ item.date_ordered }}" required>
                                        </div>

                                        <div class="mb-1">
                                            <label for="quantity" class="form-label">Quantity:</label>
                                            <input type="text" class="form-control" id="quantity" name="quantity" value="{{ item.quantity }}" required>
                                        </div>
                                    </div>
                                </div>


                                <div class="modal-footer">
                                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary">Save changes</button>
                                </div>
                                </div>
                            </div>
                            </form>
                            </div>

                            <div class="modal fade" id="deleteItemModal-{{ item.id }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="exampleModalLabel"> Delete </h1>
                                <button type="button" class="btn-close"
                                data-bs-dismiss="modal" aria-label="Close"
                                (click)="closeClick()"></button>
                            </div>

                            <div class="modal-body">
                                <p>Are you sure to delete?</p>
                            </div>


                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                                <a href="/delete_item/{{ item.id }}">
                                    <button type="button" class="btn btn-primary">Yes</button>
                                </a>
                            </div>

                            </div>
                            </div>
                            </div>

                            <div class="modal fade" id="soldItemsModal-{{ item.id }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <form action="/reduce_item_quantity/{{ item.id }}" method="post">
                                {% csrf_token %}
                                <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="exampleModalLabel"> Sold </h1>
                                    <button type="button" class="btn-close"
                                    data-bs-dismiss="modal" aria-label="Close"
                                    (click)="closeClick()"></button>
                                </div>

                                <div class="modal-body">
                                    <div class ="form-group">
                                        <div class="row"> </div>
                                        <div class="mb-1">
                                            <label for="itemName" class="form-label">Quantity (minimum: 1)</label>
                                            <input type="number" class="form-control input-sm" id="itemName" min="1" name="quantity" required>
                                        </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary">Save changes</button>
                                </div>
                                </div>
                            </div>
                            </form>
                            </div>
                    {% endif %}
                {% endfor %}
                </tbody>
            </table>

            <div class="col-md-12 text-right">
                <button type="button" 
                        class="btn btn-primary ml-2 pl-2" 
                        style="float: right; margin-left: 0.5%; font-family: Metropolis;"
                        data-bs-toggle="modal" 
                        data-bs-target="#addItemsModal" 
                >
                    <span style="font-size: 1.13em;">
                        <ion-icon name="add-circle-outline"></ion-icon> 
                    </span>
                    Add Items
                </button>

                <button type="button" 
                        class="btn btn-primary ml-2 pl-2" 
                        style="float: right; font-family: Metropolis;"
                        data-bs-toggle="modal" 
                        data-bs-target="#uploadItemsModal" 
                >
                    <span style="font-size: 1.13em;">
                        <ion-icon name="cloud-upload-outline"></ion-icon> 
                    </span>
                    Upload CSV file
                </button>
                <br>
            </div>

        </div>
    </div>
    </div>

     <!-- Add modal -->
     <div class="modal fade" id="addItemsModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <form action="/create_item" method="post">
            {% csrf_token %}
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel"> Add </h1>
                    <button type="button" class="btn-close"
                    data-bs-dismiss="modal" aria-label="Close"
                    (click)="closeClick()"></button>
                </div>

                <div class="modal-body">
                    <div class ="form-group">
                        <div class="row"> </div>
                        <div class="mb-1">
                            <label for="item_name" class="form-label">Item name:</label>
                            <input type="text" class="form-control input-sm" id="create_item_name" name="item_name" required> 
                        </div>

                        <div class="mb-1">
                            <label for="item_price" class="form-label">Item Price:</label>
                            <input type="text" class="form-control input-sm" id="create_item_price" name="item_price" required>
                        </div>

                        <div class="mb-1">
                            <label for="expense" class="form-label">Purchase Cost:</label>
                            <input type="text" class="form-control input-sm" id="create_expense" name="expense" required>
                        </div>

                        <div class="mb-1">
                            <label for="category" class="form-label">Category:</label>
                            <select name ="category" class="form-select">
                                <option selected>--</option>
                                <option value="Drinks">Drinks</option>
                                <option value="Condiments">Condiments</option>
                                <option value="Snacks">Snacks</option>
                                <option value="Canned Goods">Canned Goods</option>
                                <option value="Detergents">Detergents</option>
                                <option value="Others">Others</option>
                              </select>
                        </div>

                        <div class="mb-1">
                            <label for="quantity" class="form-label">Quantity:</label>
                            <input type="text" class="form-control" id="create_category" name="quantity" required>
                        </div>

                        <div class="mb-1">
                            <label for="date_ordered" class="form-label">Date Ordered:</label>
                            <input type="date" class="form-control" id="create_date_ordered" name="date_ordered" required>
                        </div>
                    </div>
                </div>


                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <input type="submit" class="btn btn-primary" value="Add">
                </div>

                </div>
            </div>
        </form>
    </div>

    <!-- upload modal -->

    <div class="modal fade" id="uploadItemsModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <form action="/upload_csv" method="post" enctype="multipart/form-data">
            <div class="modal-dialog modal-dialog-centered">
            {% csrf_token %}
                <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel"> Upload </h1>
                    <button type="button" class="btn-close"
                    data-bs-dismiss="modal" aria-label="Close"
                    (click)="closeClick()"></button>
                </div>

                <div class="modal-body">
                    <div class ="form-group">
                        <div class="mb-1">
                            <label for="upload" class="form-label">Upload CSV file:</label>
                            <input type="file" accept=".csv" class="form-control input-sm" name="store_data" required>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <input type="submit" class="btn btn-primary" value="Add">
                </div>

                </div>
            </div>
        </form>
    </div>
{% endblock %}